---
title: "Interactive Shade Routing Calculator"
format:
  html:
    toc: false
---

## Calculate Your Own Routes

Click on the map below to plan shade-optimized routes in University City Philadelphia.

<iframe src="map.html" width="100%" height="700px" style="border: 1px solid #ddd; border-radius: 8px;"></iframe>

---

## How to Use

1. **Select a scenario** from the dropdown menu
   - Summer Midday, Summer Morning/Evening
   - Winter Midday, Winter Morning
   - Spring Midday, Fall Midday

2. **Click on the map** to set your starting point
   - A blue marker appears at your origin

3. **Click again** to set your destination
   - A red marker appears at your destination
   - Routes calculate automatically

4. **View both routes:**
   - **Blue route**: Shortest distance path
   - **Green route**: Maximum shade path (may be longer)

5. **Compare the trade-offs**
   - Distance difference
   - Shade coverage improvement
   - Detour percentage

6. **Try different scenarios** to see how shade availability changes by season and time of day

7. **Click "Reset"** to start over

---

## What You're Seeing

### Network Visualization

The street network is colored by shade availability:
- ðŸ”´ **Red**: 0-20% shade (full sun)
- ðŸŸ  **Orange**: 20-40% shade (minimal shade)
- ðŸŸ¡ **Yellow**: 40-60% shade (moderate shade)
- ðŸŸ¢ **Light Green**: 60-80% shade (good shade)
- ðŸŸ¢ **Dark Green**: 80-100% shade (excellent shade)

### Route Comparison

**Shortest Route (Blue):**
- Minimizes walking distance
- Optimizes for time efficiency
- May cross sunny areas

**Shadiest Route (Green):**
- Maximizes shade coverage
- Balances shade benefit vs. distance penalty
- Uses shade-weighted cost: `length Ã— (1 - 0.3 Ã— shade)`

---

## Example Scenarios

### Hot Summer Afternoon

**Scenario:** Summer Midday (sun at 68.9Â° altitude)
- Shadows are short
- Shade is scarce
- Shadiest route provides significant thermal comfort improvement
- Typical detour: 10-15% longer

### Cool Winter Morning

**Scenario:** Winter Morning (sun at 14.2Â° altitude)
- Shadows are very long
- Shade is abundant
- Shadiest route often similar to shortest
- Typical detour: 5-10% longer

---

## Technical Details

### Performance

- **Network size:** 23,486 street segments
- **Route calculation:** <100ms per route pair
- **Algorithm:** Dijkstra's shortest path
- **Processing:** 100% client-side (no server needed)

### Data Format

The map uses four JSON files:
1. **nodes.json** - Network intersections (~12,000 nodes)
2. **edges.json** - Street segments with shade scores
3. **scenarios.json** - Solar position data for each scenario
4. **metadata.json** - Map bounds and configuration

### Cost Function

**Shortest path:**
```
cost = length
```

**Shadiest path:**
```
cost = length Ã— (1 - w Ã— shade)
where w = 0.3 (30% preference for shade)
```

A segment with:
- 0% shade has cost = length Ã— 1.0
- 50% shade has cost = length Ã— 0.85
- 100% shade has cost = length Ã— 0.7

This creates a 30% preference for shade while still prioritizing reasonable distances.

---

## Limitations

- **Static data:** Based on 2018-2020 LiDAR (tree canopy may have changed)
- **Clear sky assumed:** Does not account for clouds
- **No real-time updates:** Shadow positions are pre-calculated for specific dates/times
- **Simplified pedestrian comfort:** Shade is only one factor (wind, humidity, temperature also matter)
- **Network completeness:** Limited to OpenStreetMap pedestrian paths

---

## Mobile Use

The map works on mobile devices:
- Touch to set origin/destination
- Pinch to zoom
- Swipe to pan
- Works offline after initial load

---

[â† Back to Results](results.qmd) | [View Code Implementation â†’](appendix.qmd)
